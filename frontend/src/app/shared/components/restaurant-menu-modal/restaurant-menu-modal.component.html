<div class="modal-backdrop" (click)="onBackdropClick($event)">
    <div class="modal-container">
        <!-- Header with close button -->
        <div class="modal-header">
            <div class="header-content">
                <h2>{{ local.nombre }}</h2>
                <div class="rating">
                    <span *ngFor="let star of getStars(local.valoracion)" class="star">{{ star }}</span>
                    <span class="rating-value">{{ local.valoracion || 'N/A' }}</span>
                </div>
            </div>
            <button class="close-btn" (click)="onClose()">‚úï</button>
        </div>

        <!-- Restaurant info -->
        <div class="restaurant-info">
            <img *ngIf="local.imagenUrl" [src]="local.imagenUrl" [alt]="local.nombre" class="restaurant-image" />
            <div class="info-details">
                <p><strong>üìç Direcci√≥n:</strong> {{ local.direccion }}</p>
                <p *ngIf="local.horario"><strong>üïê Horario:</strong> {{ local.horario }}</p>
                <p *ngIf="local.capacidad"><strong>üë• Capacidad:</strong> {{ local.capacidad }} personas</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="border-b border-gray-200 mb-4">
            <nav class="flex space-x-4">
                <button (click)="activeTab = 'menu'"
                    [class]="activeTab === 'menu' ? 'border-primary-600 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                    class="border-b-2 py-2 px-1 font-medium transition-colors">
                    Carta / Men√∫
                </button>
                <button (click)="activeTab = 'booking'"
                    [class]="activeTab === 'booking' ? 'border-primary-600 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                    class="border-b-2 py-2 px-1 font-medium transition-colors">
                    Reservar Mesa
                </button>
            </nav>
        </div>

        <!-- Menu section -->
        <div *ngIf="activeTab === 'menu'" class="menu-section">
            <div *ngIf="menus.length === 0" class="no-menu">
                <p>No hay platos disponibles en este momento.</p>
            </div>

            <div class="menu-grid" *ngIf="menus.length > 0">
                <div *ngFor="let item of menus" class="menu-item" [class.unavailable]="!item.disponible">
                    <div class="menu-item-header">
                        <h4>{{ item.nombre }}</h4>
                        <span class="price">{{ item.precio | number:'1.2-2' }}‚Ç¨</span>
                    </div>
                    <p *ngIf="item.descripcion" class="description">{{ item.descripcion }}</p>
                    <p *ngIf="item.ingredientes" class="ingredients">
                        <strong>Ingredientes:</strong> {{ item.ingredientes }}
                    </p>
                    <div *ngIf="item.alergenos" class="allergens">
                        <span class="allergen-label">‚ö†Ô∏è Al√©rgenos:</span>
                        <span *ngFor="let a of formatAlergenos(item.alergenos)" class="allergen-tag">{{ a }}</span>
                    </div>
                    <div *ngIf="!item.disponible" class="unavailable-badge">No disponible</div>
                </div>
            </div>
        </div>

        <!-- Booking Section -->
        <div *ngIf="activeTab === 'booking'" class="p-4 bg-gray-50 rounded-lg">
            <div *ngIf="authService.isLoggedIn(); else loginPrompt">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Realizar Reserva</h3>
                <form (submit)="makeReservation()" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Fecha</label>
                            <input [(ngModel)]="bookingData.fecha" name="fecha" type="date"
                                class="w-full p-2 border rounded shadow-sm" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Hora</label>
                            <input [(ngModel)]="bookingData.hora" name="hora" type="time"
                                class="w-full p-2 border rounded shadow-sm" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Personas</label>
                        <input [(ngModel)]="bookingData.personas" name="personas" type="number" min="1" max="20"
                            class="w-full p-2 border rounded shadow-sm" required>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Observaciones</label>
                        <textarea [(ngModel)]="bookingData.observaciones" name="observaciones" rows="3"
                            class="w-full p-2 border rounded shadow-sm"
                            placeholder="Alergias, mesa preferida..."></textarea>
                    </div>
                    <button type="submit"
                        class="w-full bg-primary-600 text-white font-bold py-3 rounded-lg hover:bg-primary-700 transition shadow-md">
                        Confirmar Reserva
                    </button>
                </form>
            </div>
            <ng-template #loginPrompt>
                <div class="text-center py-8">
                    <p class="text-gray-600 mb-4">Debes iniciar sesi√≥n para realizar una reserva.</p>
                    <a href="/login"
                        class="inline-block bg-secondary-500 text-white px-6 py-2 rounded-full font-bold shadow hover:bg-secondary-600 transition">
                        Iniciar Sesi√≥n
                    </a>
                </div>
            </ng-template>
        </div>
    </div>
</div>