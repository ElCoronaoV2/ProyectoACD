<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-white">Panel de Empleado</h1>
        <div *ngIf="myLocal" class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full font-bold">
            üè¢ {{ myLocal.nombre }}
        </div>
    </div>

    <div *ngIf="!myLocal" class="bg-red-100 text-red-800 p-4 rounded text-center">
        No tienes ning√∫n restaurante asignado. Contacta con tu CEO.
    </div>

    <div *ngIf="myLocal">
        <!-- Main Tabs -->
        <div class="flex space-x-1 mb-6 bg-white/10 p-1 rounded-xl w-fit">
            <button (click)="activeTab = 'reservas'"
                [class]="activeTab === 'reservas' ? 'bg-primary-600 text-white shadow-lg' : 'text-white/70 hover:text-white hover:bg-white/10'"
                class="px-6 py-2 rounded-lg transition-all font-medium">
                üìÖ Reservas
            </button>
            <button (click)="activeTab = 'menus'"
                [class]="activeTab === 'menus' ? 'bg-primary-600 text-white shadow-lg' : 'text-white/70 hover:text-white hover:bg-white/10'"
                class="px-6 py-2 rounded-lg transition-all font-medium">
                üçΩÔ∏è Men√∫ del D√≠a
            </button>
        </div>

        <!-- VISTA RESERVAS -->
        <div *ngIf="activeTab === 'reservas'">

            <!-- Reservation Sub-Tabs -->
            <div class="flex space-x-4 mb-4 border-b border-white/20 pb-2">
                <button (click)="activeReservationTab = 'hoy'"
                    [class]="activeReservationTab === 'hoy' ? 'border-b-2 border-white text-white font-bold' : 'text-white/60 hover:text-white'"
                    class="px-4 py-2 transition-colors">
                    Hoy ({{ todayReservations.length }})
                </button>
                <button (click)="activeReservationTab = 'proximas'"
                    [class]="activeReservationTab === 'proximas' ? 'border-b-2 border-white text-white font-bold' : 'text-white/60 hover:text-white'"
                    class="px-4 py-2 transition-colors">
                    Pr√≥ximas ({{ upcomingReservations.length }})
                </button>
                <button (click)="activeReservationTab = 'historial'"
                    [class]="activeReservationTab === 'historial' ? 'border-b-2 border-white text-white font-bold' : 'text-white/60 hover:text-white'"
                    class="px-4 py-2 transition-colors">
                    Historial
                </button>
            </div>

            <div class="space-y-4">
                <!-- Determine which list to show -->
                <ng-container
                    *ngFor="let res of (activeReservationTab === 'hoy' ? todayReservations : (activeReservationTab === 'proximas' ? upcomingReservations : historyReservations))">
                    <div class="bg-white p-4 rounded-lg shadow border-l-4" [ngClass]="{
                        'border-green-500': res.estado === 'CONFIRMADA',
                        'border-purple-500': res.estado === 'ASISTIDO',
                        'border-gray-500': res.estado === 'NO_ASISTIDO',
                        'border-yellow-500': res.estado === 'PENDIENTE',
                        'border-red-500': res.estado === 'CANCELADA',
                        'border-blue-500': res.estado === 'COMPLETADA'
                     }">
                        <div class="flex justify-between items-start flex-wrap gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-lg font-bold text-gray-800">{{ getReservationName(res) }}</span>
                                    <span class="px-2 py-1 text-xs font-bold rounded-full"
                                        [class.bg-green-100]="res.estado === 'CONFIRMADA'"
                                        [class.text-green-800]="res.estado === 'CONFIRMADA'"
                                        [class.bg-purple-100]="res.estado === 'ASISTIDO'"
                                        [class.text-purple-800]="res.estado === 'ASISTIDO'"
                                        [class.bg-gray-100]="res.estado === 'NO_ASISTIDO'"
                                        [class.text-gray-800]="res.estado === 'NO_ASISTIDO'"
                                        [class.bg-yellow-100]="res.estado === 'PENDIENTE'"
                                        [class.text-yellow-800]="res.estado === 'PENDIENTE'"
                                        [class.bg-red-100]="res.estado === 'CANCELADA'"
                                        [class.text-red-800]="res.estado === 'CANCELADA'"
                                        [class.bg-blue-100]="res.estado === 'COMPLETADA'"
                                        [class.text-blue-800]="res.estado === 'COMPLETADA'">
                                        {{ res.estado.replace('_', ' ') }}
                                    </span>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600">
                                    <div>
                                        <span class="font-medium text-gray-500">Fecha:</span>
                                        <p class="font-bold text-gray-800">{{ res.fechaHora | date:'dd/MM/yyyy' }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-500">Hora:</span>
                                        <p class="font-bold text-gray-800">{{ res.fechaHora | date:'HH:mm' }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-500">Turno:</span>
                                        <p class="font-bold text-gray-800">{{ getShiftLabel(res.fechaHora) }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-500">Personas:</span>
                                        <p class="font-bold text-gray-800">üë• {{ res.numeroPersonas }}</p>
                                    </div>
                                </div>
                                <p *ngIf="res.observaciones" class="mt-2 text-sm text-gray-500 italic">
                                    üí¨ {{ res.observaciones }}
                                </p>
                            </div>

                            <!-- Actions -->
                            <div class="flex flex-col gap-2">
                                <!-- Show Attendance Buttons ONLY for Today's Confirmed/Pending reservations -->
                                <div *ngIf="activeReservationTab === 'hoy' && (res.estado === 'CONFIRMADA' || res.estado === 'PENDIENTE')"
                                    class="flex gap-2">
                                    <button (click)="markAttendance(res.id, true)"
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow font-bold text-sm transition flex items-center gap-2">
                                        <span>üôã‚Äç‚ôÇÔ∏è</span> Confirmar Asistencia
                                    </button>
                                </div>

                                <div *ngIf="res.estado === 'PENDIENTE' || res.estado === 'CONFIRMADA'"
                                    class="flex justify-end">
                                    <button (click)="cancelReservation(res.id)"
                                        class="text-red-500 hover:text-red-700 hover:underline text-xs font-medium px-2 py-1">
                                        Cancelar reserva
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <div *ngIf="(activeReservationTab === 'hoy' ? todayReservations : (activeReservationTab === 'proximas' ? upcomingReservations : historyReservations)).length === 0"
                    class="text-center py-12 text-white/50">
                    <p class="text-4xl mb-2">üì≠</p>
                    <p>No hay reservas en esta secci√≥n.</p>
                </div>
            </div>
        </div>

        <!-- VISTA MENUS -->
        <div *ngIf="activeTab === 'menus'">
            <div class="space-y-4">
                <h3 class="font-bold text-lg mb-2 text-white">Men√∫ Programado para Hoy</h3>

                <div *ngFor="let menu of menus"
                    class="bg-white border rounded-xl overflow-hidden shadow-lg transform transition hover:scale-[1.01]">
                    <!-- Header with Gradient matching PDF style -->
                    <div class="bg-gradient-to-r from-orange-800 via-orange-600 to-amber-600 p-4 text-white">
                        <div class="flex justify-between items-start">
                            <h4 class="text-xl font-bold">{{ menu.nombre }}</h4>
                            <span class="bg-white/20 px-3 py-1 rounded-full font-bold text-lg backdrop-blur-sm">
                                {{ menu.precio }}‚Ç¨
                            </span>
                        </div>
                        <p class="text-white/80 text-sm mt-1">{{ menu.descripcion }}</p>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Platos -->
                        <div class="grid md:grid-cols-3 gap-6">
                            <!-- Primero -->
                            <div class="space-y-2">
                                <h5 class="font-bold text-amber-700 flex items-center gap-2 border-b pb-1">
                                    üçΩÔ∏è Primer Plato
                                </h5>
                                <p class="font-medium text-gray-800">{{ menu.primerPlato }}</p>
                                <p class="text-sm text-gray-500 italic">{{ menu.primerPlatoDesc }}</p>
                            </div>
                            <!-- Segundo -->
                            <div class="space-y-2">
                                <h5 class="font-bold text-amber-700 flex items-center gap-2 border-b pb-1">
                                    ü•ò Segundo Plato
                                </h5>
                                <p class="font-medium text-gray-800">{{ menu.segundoPlato }}</p>
                                <p class="text-sm text-gray-500 italic">{{ menu.segundoPlatoDesc }}</p>
                            </div>
                            <!-- Postre -->
                            <div class="space-y-2">
                                <h5 class="font-bold text-amber-700 flex items-center gap-2 border-b pb-1">
                                    üç∞ Postre
                                </h5>
                                <p class="font-medium text-gray-800">{{ menu.postre }}</p>
                                <p class="text-sm text-gray-500 italic">{{ menu.postreDesc }}</p>
                            </div>
                        </div>

                        <!-- Alergenos -->
                        <div *ngIf="menu.alergenos" class="mt-4 pt-4 border-t border-gray-100">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">Al√©rgenos</p>
                            <div class="flex flex-wrap gap-2">
                                <span *ngFor="let alg of menu.alergenos.split(',')"
                                    class="px-2 py-1 bg-orange-50 text-orange-700 text-xs rounded border border-orange-100 flex items-center gap-1">
                                    ‚ö†Ô∏è {{ alg.trim() }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="menus.length === 0"
                    class="text-center py-12 bg-white/5 rounded-xl border border-white/10 text-white/60">
                    <p class="text-5xl mb-4">üìÖ</p>
                    <p class="text-xl">No hay men√∫ programado para el d√≠a de hoy.</p>
                </div>
            </div>
        </div>
    </div>
</div>