<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Mi Perfil</h1>

    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Datos Personales</h2>
        <div *ngIf="user" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Nombre</label>
                <input type="text" [value]="user.nombre" readonly
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-gray-50 p-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" [value]="user.email" readonly
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-gray-50 p-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Rol</label>
                <span
                    class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    {{ user.rol }}
                </span>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Datos Personales</h2>
            <button (click)="toggleEdit()" class="text-primary-600 hover:underline font-medium">
                {{ editMode ? 'Cancelar' : 'Editar' }}
            </button>
        </div>

        <div *ngIf="user && !editMode" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Nombre</label>
                <div class="p-2 bg-gray-50 rounded border border-gray-200">{{ user.nombre }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Email</label>
                <div class="p-2 bg-gray-50 rounded border border-gray-200">{{ user.email }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                <div class="p-2 bg-gray-50 rounded border border-gray-200">{{ user.telefono || 'No definido' }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Al√©rgenos</label>
                <div class="p-2 bg-gray-50 rounded border border-gray-200">{{ user.alergenos || 'Ninguno' }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Rol</label>
                <span
                    class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    {{ user.rol }}
                </span>
            </div>
        </div>

        <div *ngIf="editMode" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Nombre</label>
                <input [(ngModel)]="updatedUser.nombre" class="input-field w-full">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                <input [(ngModel)]="updatedUser.telefono" class="input-field w-full">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Al√©rgenos</label>
                <input [(ngModel)]="updatedUser.alergenos" placeholder="Ej: Gluten, Lactosa" class="input-field w-full">
            </div>
            <button (click)="saveProfile()" class="btn-primary w-full">Guardar Cambios</button>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Historial de Reservas</h2>

        <div *ngIf="reservations.length === 0" class="text-gray-500 text-center py-4">
            No tienes reservas registradas.
        </div>

        <div *ngFor="let res of reservations" class="border-b last:border-0 py-4 flex justify-between items-center">
            <div>
                <p class="font-bold text-lg">{{ res.local?.nombre || 'Restaurante' }}</p>
                <p class="text-sm text-gray-600">üìÖ {{ res.fechaHora | date:'medium' }} - {{ res.numeroPersonas }} pax
                </p>
                <span class="px-2 py-1 rounded text-xs font-bold" [ngClass]="{
                        'bg-green-100 text-green-800': res.estado === 'CONFIRMADA',
                        'bg-yellow-100 text-yellow-800': res.estado === 'PENDIENTE',
                        'bg-red-100 text-red-800': res.estado === 'CANCELADA'
                        }">
                    {{ res.estado }}
                </span>
            </div>
            <div>
                <button *ngIf="res.estado === 'PENDIENTE'" (click)="cancelReservation(res.id)"
                    class="text-red-500 hover:text-red-700 font-bold border border-red-500 rounded px-3 py-1 text-sm hover:bg-red-50">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>