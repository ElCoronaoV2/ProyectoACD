<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-white">Mi Perfil</h1>

    <div class="bg-gray-800/50 backdrop-blur-sm rounded-lg shadow-xl border border-gray-700 p-6 mb-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-white">Datos Personales</h2>
            <button (click)="toggleEdit()" class="text-amber-500 hover:text-amber-400 font-medium transition-colors">
                {{ editMode ? 'Cancelar' : 'Editar' }}
            </button>
        </div>

        <div *ngIf="user && !editMode" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-400">Nombre</label>
                <div class="p-3 bg-gray-700/50 rounded-md border border-gray-600 text-white">{{ user.nombre }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400">Email</label>
                <div class="p-3 bg-gray-700/50 rounded-md border border-gray-600 text-white">{{ user.email }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400">Tel√©fono</label>
                <div class="p-3 bg-gray-700/50 rounded-md border border-gray-600 text-white">{{ user.telefono || 'No definido' }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400">Al√©rgenos</label>
                <div class="p-3 bg-gray-700/50 rounded-md border border-gray-600 text-white">{{ user.alergenos || 'Ninguno' }}</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400">Rol</label>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-900/50 text-amber-400 border border-amber-600">
                    {{ user.rol }}
                </span>
            </div>
        </div>

        <div *ngIf="editMode" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Nombre</label>
                <input [(ngModel)]="updatedUser.nombre" 
                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Tel√©fono</label>
                <input [(ngModel)]="updatedUser.telefono" 
                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Al√©rgenos</label>
                <input [(ngModel)]="updatedUser.alergenos" placeholder="Ej: Gluten, Lactosa" 
                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
            </div>
            <button (click)="saveProfile()" 
                class="w-full py-3 px-4 bg-amber-600 hover:bg-amber-700 text-white font-semibold rounded-md transition-colors shadow-lg">
                Guardar Cambios
            </button>
        </div>
    </div>

    <div class="bg-gray-800/50 backdrop-blur-sm rounded-lg shadow-xl border border-gray-700 p-6">
        <h2 class="text-xl font-semibold mb-4 text-white">Historial de Reservas</h2>

        <div *ngIf="reservations.length === 0" class="text-gray-400 text-center py-8">
            No tienes reservas registradas.
        </div>

        <div *ngFor="let res of reservations" class="border-b border-gray-700 last:border-0 py-4 flex justify-between items-center">
            <div>
                <p class="font-bold text-lg text-white">{{ res.local?.nombre || 'Restaurante' }}</p>
                <p class="text-sm text-gray-400">üìÖ {{ res.fechaHora | date:'medium' }} - {{ res.numeroPersonas }} pax</p>
                <span class="px-2 py-1 rounded text-xs font-bold mt-1 inline-block" [ngClass]="{
                        'bg-green-900/50 text-green-400 border border-green-600': res.estado === 'CONFIRMADA',
                        'bg-yellow-900/50 text-yellow-400 border border-yellow-600': res.estado === 'PENDIENTE',
                        'bg-red-900/50 text-red-400 border border-red-600': res.estado === 'CANCELADA'
                        }">
                    {{ res.estado }}
                </span>
            </div>
            <div>
                <button *ngIf="res.estado === 'PENDIENTE'" (click)="cancelReservation(res.id)"
                    class="text-red-400 hover:text-red-300 font-bold border border-red-500 rounded px-3 py-1 text-sm hover:bg-red-900/30 transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>